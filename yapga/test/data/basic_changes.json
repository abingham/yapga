[{"revisions": {
    "82703204a97988d2b39714c4e0cb879506a3e23f": {
        "commit": {
            "message": "ndk: Add missing declaration for mkdtemp\n\nThe mkdtemp() function has always been implemented in the C library\n(see [1] for proof) but was missing a declaration in <stdlib.h>, until\nAndroid 4.0.1 [2]\n\nThis patch simply adds the missing declaration to former <stdlib.h>\nversions. This makes it easier to build certain open-source programs\nfor Android, because auto-tools probing typically looks at the symbols\nin libc.so to define HAVE_MKDTEMP, then the source fails to compile\nbecause of the lack of declaration.\n\nNote that the mkdtemp is also already listed in\nplatforms/android-*/arch-*/symbols/libc.so.functions.txt, which were\ngenerated by parsing actual system libraries, and thus don't need to\nbe updated here.\n\n[1] https://android.googlesource.com/platform/bionic/+/android-1.6_r1/libc/stdio/mktemp.c\n    https://android.googlesource.com/platform/bionic/+/android-1.6_r1/libc/Android.mk\n\n[2] https://android.googlesource.com/platform/bionic/+/ad1ff2fb268034074488f0b4b30b5311008b8617\n\nChange-Id: I838b54bcb5cbfd2fed24cf7649897889ec7a5559\n", "subject": "ndk: Add missing declaration for mkdtemp",
            "committer": {
                "tz": 60,
                "email": "digit@android.com",
                "date": "2013-10-28 17:46:54.000000000",
                "name": "David 'Digit' Turner"},
            "parents": [
                {"commit": "8edf8ef6aadc1a568be40d52c0da659c2b1f5aa8",
                 "kind": "gerritcodereview#commit",
                 "subject": "Merge \"Refresh sysroot headers for aarch64.\""}],
            "author": {
                "tz": 120,
                "email": "digit@android.com",
                "date": "2013-10-24 17:39:13.000000000",
                "name": "David 'Digit' Turner"},
            "kind": "gerritcodereview#commit"},
        "_number": 2,
        "files": {
            "ndk/platforms/android-9/include/stdlib.h": {
                "lines_inserted": 1},
            "ndk/platforms/android-3/include/stdlib.h": {
                "lines_inserted": 1},
            "ndk/platforms/android-8/include/stdlib.h": {
                "lines_inserted": 1}},
        "fetch": {
            "http": {
                "url": "https://android.googlesource.com/platform/development",
                "ref": "refs/changes/00/68700/2"},
            "repo": {
                "url": "platform/development",
                "ref": "refs/changes/00/68700/2"}}},
    "8af9778ed9b3e337b6a63669799d75553f3364a7": {
        "commit": {
            "message": "ndk: Add missing declaration for mkdtemp.h.\n\nThe mkdtemp() function has always been implemented in the C library\n(see [1] for proof) but was missing a declaration in <stdlib.h>, until\nAndroid 4.0.1 [2]\n\nThis patch simply adds the missing declaration to former <stdlib.h>\nversions. This makes it easier to build certain open-source programs\nfor Android, because auto-tools probing typically looks at the symbols\nin libc.so to define HAVE_MKDTEMP, then the source fails to compile\nbecause of the lack of declaration.\n\n[1] https://android.googlesource.com/platform/bionic/+/android-1.6_r1/libc/stdio/mktemp.c\n[2] https://android.googlesource.com/platform/bionic/+/ad1ff2fb268034074488f0b4b30b5311008b8617\n\nChange-Id: I838b54bcb5cbfd2fed24cf7649897889ec7a5559\n", "subject": "ndk: Add missing declaration for mkdtemp.h.",
            "committer": {
                "tz": 120,
                "email": "digit@android.com",
                "date": "2013-10-24 17:44:09.000000000",
                "name": "David 'Digit' Turner"},
            "parents": [{
                "commit": "8edf8ef6aadc1a568be40d52c0da659c2b1f5aa8",
                "kind": "gerritcodereview#commit",
                "subject": "Merge \"Refresh sysroot headers for aarch64.\""}],
            "author": {
                "tz": 120,
                "email": "digit@android.com",
                "date": "2013-10-24 17:39:13.000000000",
                "name": "David 'Digit' Turner"},
            "kind": "gerritcodereview#commit"},
        "_number": 1,
        "files": {
            "ndk/platforms/android-9/include/stdlib.h": {
                "lines_inserted": 1},
            "ndk/platforms/android-3/include/stdlib.h": {
                "lines_inserted": 1},
            "ndk/platforms/android-8/include/stdlib.h": {
                "lines_inserted": 1}},
        "fetch": {
            "http": {
                "url": "https://android.googlesource.com/platform/development",
                "ref": "refs/changes/00/68700/1"},
            "repo": {"url": "platform/development",
                     "ref": "refs/changes/00/68700/1"}}}},
  "subject": "ndk: Add missing declaration for mkdtemp",
  "messages": [
      {"message": "Uploaded patch set 1.",
       "id": "7e541cb1_86e92c30",
       "_revision_number": 1,
       "date": "2013-10-24 17:46:34.074000000",
       "author": {
           "name": "David Turner"}},
      {"message": "Patch Set 1: Code-Review+1\n\n(stray .h on first line of checkin comment!)\n\ni checked the libc.so.functions.txt files and it looks like these were actually built. (a stronger guarantee than \"we had a source file checked in\"!)",
       "id": "1e5ec0fd_02a8eb80",
       "_revision_number": 1,
       "date": "2013-10-28 16:30:50.199000000",
       "author": {
           "name": "Elliott Hughes"}},
      {"message": "Uploaded patch set 2.",
       "id": "7ec09cbf_c9b715c7",
       "_revision_number": 2,
       "date": "2013-10-28 17:49:35.585000000",
       "author": {"name": "David Turner"}},
      {"message": "Patch Set 1:\n\nThanks, I've fixed the commit message. I should have mentioned that I also checked the Android.mk, as well as libc.functions.so.txt which already list mkdtemp properly :)",
       "id": "de8ee8b0_41603438",
       "_revision_number": 1,
       "date": "2013-10-28 17:50:18.655000000",
       "author": {"name": "David Turner"}},
      {"message": "Patch Set 2: Verified+1 Code-Review+2",
       "id": "fe89eca8_df5edb4f",
       "_revision_number": 2,
       "date": "2013-10-29 01:52:20.677000000",
       "author": {
           "name": "Andrew Hsieh"}},
      {"message": "Change has been successfully merged into the git repository.",
       "id": "3e80e478_84aa48ac",
       "_revision_number": 2,
       "date": "2013-10-29 01:52:28.569000000",
       "author": {
           "name": "Andrew Hsieh"}}],
  "branch": "master",
  "change_id": "I838b54bcb5cbfd2fed24cf7649897889ec7a5559",
  "updated": "2013-10-29 01:52:22.749000000",
  "kind": "gerritcodereview#change",
  "id": "platform%2Fdevelopment~master~I838b54bcb5cbfd2fed24cf7649897889ec7a5559",
  "owner": {"name": "David Turner"},
  "_number": 68700,
  "project": "platform/development",
  "status": "MERGED",
  "current_revision": "82703204a97988d2b39714c4e0cb879506a3e23f",
  "_sortkey": "0028bd3000010c5c",
  "created": "2013-10-24 17:46:34.074000000"},
 {"revisions": {
     "2028ce9ae9d8c71d64b5cd5364049daa7e2d7fed": {"commit": {"message": "Revert \"Drop -d option on insertkeys.py in Android.mk\"\n\nFor reasons that I don't yet understand, this change is causing\nGoogle's /system/etc/security/mac_permissions.xml to differ\nfrom the keys we use to sign the APKs. This is causing apps\nto run in the wrong SELinux domain.\n\nSteps to reproduce.\n\n1) Compile and boot Android.\n2) Run the following command: \"adb shell ps -Z | grep process.media\"\n\nExpected:\n\n  $ adb shell ps -Z | grep process.media\n  u:r:media_app:s0               u0_a5     1332  202   android.process.media\n\nActual:\n\n  $ adb shell ps -Z | grep process.media\n  u:r:untrusted_app:s0           u0_a5     3617  187   android.process.media\n\nThis reverts commit 9af6f1bd59ee2fb0622db8ff25c4806c5527a0b3.\n\nBug: 11327304\nChange-Id: Ica24fb25c5f9c0e2f4d181718c757cf372467822\n", "subject": "Revert \"Drop -d option on insertkeys.py in Android.mk\"", "committer": {"tz": -420, "email": "nnk@google.com", "date": "2013-10-25 19:30:17.000000000", "name": "Nick Kralevich"}, "parents": [{"commit": "c4a3b51062cfc9eaf38d997b6d6609a7dcf3a3c4", "kind": "gerritcodereview#commit", "subject": "sysfs_devices_system_cpu should be a sysfs_type"}], "author": {"tz": -420, "email": "nnk@google.com", "date": "2013-10-25 19:25:36.000000000", "name": "Nick Kralevich"}, "kind": "gerritcodereview#commit"}, "_number": 1, "files": {"Android.mk": {"lines_inserted": 1, "lines_deleted": 1}, "keys.conf": {"lines_inserted": 6, "lines_deleted": 6}}, "fetch": {"http": {"url": "https://android.googlesource.com/platform/external/sepolicy", "ref": "refs/changes/80/68880/1"}, "repo": {"url": "platform/external/sepolicy", "ref": "refs/changes/80/68880/1"}}},
     "5b357a48746884ec647bb52dbe96f46eb40e1fb9": {"commit": {"message": "Make DEFAULT_SYSTEM_DEV_CERTIFICATE available in keys.conf\n\nIn 9af6f1bd59ee2fb0622db8ff25c4806c5527a0b3, the -d option\nwas dropped from insertkeys.py. This was done to allow an\nAndroid distribution to replace the default version of\nkeys.conf distributed in external/sepolicy/keys.conf. keys.conf\nwas modified to reference the publicly known test keys in\nbuild/target/product/security.\n\nUnfortunately, this broke Google's build of Android. Instead\nof incorporating our keys directory, we were using the\ndefault AOSP keys. As a result, apps were getting assigned\nto the wrong SELinux domain. (see \"Steps to reproduce\" below)\n\nThis change continues to allow others to replace keys.conf,\nbut makes DEFAULT_SYSTEM_DEV_CERTIFICATE available in case\nthe customized version wants to make reference to it.\nThis change also modifies the stock version of keys.conf\nto use DEFAULT_SYSTEM_DEV_CERTIFICATE, which should be appropriate\nfor most Android distributions. It doesn't make any sense to\nforce each OEM to have a copy of this file.\n\nSteps to reproduce.\n\n1) Compile and boot Android.\n2) Run the following command: \"adb shell ps -Z | grep process.media\"\n\nExpected:\n\n  $ adb shell ps -Z | grep process.media\n  u:r:media_app:s0               u0_a5     1332  202   android.process.media\n\nActual:\n\n  $ adb shell ps -Z | grep process.media\n  u:r:untrusted_app:s0           u0_a5     3617  187   android.process.media\n\nBug: 11327304\nChange-Id: Ica24fb25c5f9c0e2f4d181718c757cf372467822\n", "subject": "Make DEFAULT_SYSTEM_DEV_CERTIFICATE available in keys.conf", "committer": {"tz": -420, "email": "nnk@google.com", "date": "2013-10-28 19:27:40.000000000", "name": "Nick Kralevich"}, "parents": [{"commit": "73c5ea722c7ee328f0d10179601afd9d5a054b94", "kind": "gerritcodereview#commit", "subject": "fix typo"}], "author": {"tz": -420, "email": "nnk@google.com", "date": "2013-10-25 19:25:36.000000000", "name": "Nick Kralevich"}, "kind": "gerritcodereview#commit"}, "_number": 2, "files": {"Android.mk": {"lines_inserted": 2}, "keys.conf": {"lines_inserted": 6, "lines_deleted": 6}}, "fetch": {"http": {"url": "https://android.googlesource.com/platform/external/sepolicy", "ref": "refs/changes/80/68880/2"}, "repo": {"url": "platform/external/sepolicy", "ref": "refs/changes/80/68880/2"}}},
     "c3c9052bc7bf7f55e66a7560a28800066a6e044b": {"commit": {"message": "Make DEFAULT_SYSTEM_DEV_CERTIFICATE available in keys.conf\n\nIn 9af6f1bd59ee2fb0622db8ff25c4806c5527a0b3, the -d option\nwas dropped from insertkeys.py. This was done to allow an\nAndroid distribution to replace the default version of\nkeys.conf distributed in external/sepolicy/keys.conf. keys.conf\nwas modified to reference the publicly known test keys in\nbuild/target/product/security.\n\nUnfortunately, this broke Google's build of Android. Instead\nof incorporating our keys directory, we were using the\ndefault AOSP keys. As a result, apps were getting assigned\nto the wrong SELinux domain. (see \"Steps to reproduce\" below)\n\nThis change continues to allow others to replace keys.conf,\nbut makes DEFAULT_SYSTEM_DEV_CERTIFICATE available as an\nenvironment variable in case the customized version wants to\nmake reference to it. This change also modifies the stock\nversion of keys.conf to use DEFAULT_SYSTEM_DEV_CERTIFICATE,\nwhich should be appropriate for most Android distributions.\nIt doesn't make any sense to force each OEM to have a copy of\nthis file.\n\nSteps to reproduce.\n\n1) Compile and boot Android.\n2) Run the following command: \"adb shell ps -Z | grep process.media\"\n\nExpected:\n\n  $ adb shell ps -Z | grep process.media\n  u:r:media_app:s0               u0_a5     1332  202   android.process.media\n\nActual:\n\n  $ adb shell ps -Z | grep process.media\n  u:r:untrusted_app:s0           u0_a5     3617  187   android.process.media\n\nBug: 11327304\nChange-Id: Ica24fb25c5f9c0e2f4d181718c757cf372467822\n", "subject": "Make DEFAULT_SYSTEM_DEV_CERTIFICATE available in keys.conf", "committer": {"tz": -420, "email": "nnk@google.com", "date": "2013-10-28 20:08:14.000000000", "name": "Nick Kralevich"}, "parents": [{"commit": "73c5ea722c7ee328f0d10179601afd9d5a054b94", "kind": "gerritcodereview#commit", "subject": "fix typo"}], "author": {"tz": -420, "email": "nnk@google.com", "date": "2013-10-25 19:25:36.000000000", "name": "Nick Kralevich"}, "kind": "gerritcodereview#commit"}, "_number": 3, "files": {"Android.mk": {"lines_inserted": 2, "lines_deleted": 1}, "keys.conf": {"lines_inserted": 6, "lines_deleted": 6}}, "fetch": {"http": {"url": "https://android.googlesource.com/platform/external/sepolicy", "ref": "refs/changes/80/68880/3"}, "repo": {"url": "platform/external/sepolicy", "ref": "refs/changes/80/68880/3"}}}
},
  "subject": "Make DEFAULT_SYSTEM_DEV_CERTIFICATE available in keys.conf",
  "messages": [
      {"message": "Uploaded patch set 1.", "id": "1e5ec0fd_fef0f981", "_revision_number": 1, "date": "2013-10-25 19:30:25.235000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 1:\n\nOur tree seems to be behaving correctly. Not sure I have any real solutions to this one. I do know that if you include the '-d' option then you most likely *don't* want the path listed in the keys.conf file. And if you don't include the '-d' option then you most likely *do* want the paths listed in the keys.conf. \n\nWhat did your mac_permissions.xml file look like before this patch. Was the \"@PLATFORM\" and others where the sigs should be?\n\nThere is a \"os.chdir(options.root)\" in the code so maybe there was a path issue depending on how this script was actually run.", "id": "5ed67883_ca5c2351", "_revision_number": 1, "date": "2013-10-25 21:06:14.225000000", "author": {"name": "Robert Craig"}},
      {"message": "Patch Set 1:\n\nFor Google builds, we create a file in vendor/google/products/product_name.mk which contains the following line:\n\nPRODUCT_DEFAULT_DEV_CERTIFICATE := vendor/google/path/to/certs\n\nWhen this value is set, DEFAULT_SYSTEM_DEV_CERTIFICATE changes from build/target/product/security/testkey to vendor/google/path/to/certs (see build/core/config.mk).\n\nIn https://android-review.googlesource.com/64110 , DEFAULT_SYSTEM_DEV_CERTIFICATE is no longer honored, as a result, the certificate lookup falls back to the contents of keys.conf, which is \"build/target/product/security/*\". \n\nThe certificates in build/target/product/security/* are inappropriate for building at Google. We need to use the certs in vendor/google/path/to/certs , and mac_permissions.xml needs to reflect that.", "id": "1e5ec0fd_075000db", "_revision_number": 1, "date": "2013-10-25 23:01:35.328000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 1:\n\nIn the original patch, how did you intend for multiple keys to be supported? There's reference in the commit message to DEFAULT_SYSTEM_DEV_CERTIFICATE , but the commit itself removes any use of this variable.\n\nAFAIK, the -d option is needed to tell the script the value of DEFAULT_SYSTEM_DEV_CERTIFICATE, and the keys.conf paths have to be removed to allow the script to find the files. That's essentially what the rollback does.\n\n(I apologize, I wasn't on the original review of this change, so I'm not sure what the original patch was suppose to accomplish...)", "id": "1e5ec0fd_2717c40c", "_revision_number": 1, "date": "2013-10-25 23:11:32.559000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 1:\n\n> For Google builds, we create a file in vendor/google/products/product_name.mk which contains the following line: PRODUCT_DEFAULT_DEV_CERTIFICATE := vendor/google/path/to/certs\n\nWe do exactly the same thing. And use the same variable. Our device-partial.mk file out in the vendor directory contains has the following entries:\n\n BOARD_SEPOLICY_DIRS += vendor/google/common/sepolicy\n\n BOARD_SEPOLICY_REPLACE += keys.conf\n\n PRODUCT_DEFAULT_DEV_CERTIFICATE:=vendor/google/common/sepolicy/testkey\n\nThen our keys.conf is something like:\n\n [@PLATFORM]\n ALL : vendor/google/common/sepolicy/platform.x509.pem\n\nDoes something like this work for you. Of course you might have to revert the revert to test.", "id": "1ed08087_cb4f093c", "_revision_number": 1, "date": "2013-10-25 23:23:38.108000000", "author": {"name": "Robert Craig"}},
      {"message": "Patch Set 1:\n\nNot opposed to reverting if needed and thus accepting your change. Bill was the one who proposed the original change. We probably should of been more descriptive with why the change was needed and what the implications were.", "id": "1ed08087_2b6505b9", "_revision_number": 1, "date": "2013-10-25 23:25:18.399000000", "author": {"name": "Robert Craig"}},
      {"message": "Patch Set 1: Code-Review+1", "id": "7ea7bc23_918a5cde", "_revision_number": 1, "date": "2013-10-28 17:49:01.644000000", "author": {"name": "Stephen Smalley"}},
      {"message": "Uploaded patch set 2.", "id": "5e49184c_d8d50506", "_revision_number": 2, "date": "2013-10-28 19:36:41.952000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 2:\n\nHere's a different version of the change, which keeps the intention behind 9af6f1bd59ee2fb0622db8ff25c4806c5527a0b3,\nbut does it in a slightly different way.\n\nRequiring each OEM to have their own copy of keys.conf seems error prone and hard to maintain. With this change, OEMs can continue to use the default keys.conf file if they so desire, but if they need to replace it, they do as Robert suggested.\n\nPlease take a look.", "id": "bec694d7_6b11b514", "_revision_number": 2, "date": "2013-10-28 19:38:59.559000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 2:\n\n(1 comment)", "id": "1ed08087_2e923354", "_revision_number": 2, "date": "2013-10-28 19:46:05.943000000", "author": {"name": "William Roberts"}},
      {"message": "Patch Set 2:\n\ncant we export your path and use:\nhttps://android-review.googlesource.com/63370", "id": "5ed67883_50dd84f5", "_revision_number": 2, "date": "2013-10-28 19:51:20.781000000", "author": {"name": "William Roberts"}},
      {"message": "Uploaded patch set 3.", "id": "1e5ec0fd_d3088342", "_revision_number": 3, "date": "2013-10-28 20:09:25.324000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 2:\n\n(1 comment)\n\ngood idea to use the environment variable functionality. I wasn't aware it existed...  :-(\n\nThanks!", "id": "fed48c7e_cae6e39d", "_revision_number": 2, "date": "2013-10-28 20:10:38.255000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 2:\n\nI think it could work like this...\n\nif PRODUCT_DEFAULT_DEV_CERTIFICATE is not set then set it as DEFAULT_SYSTEM_DEV_CERTIFICATE (or what I do on user builds is throw an error if the test keys are used).\n\nthis way all paths:\n\n[@TAG]\nall: $PRODUCT_DEFAULT_DEV_CERTIFICATE/<somekey>.pem\n\nAre consistent. Does this meet your use case? and are we successful at getting this configuration to work?\n\nwe could export this, or pass it directly to the tool via the -d option.", "id": "5ed67883_504f44e1", "_revision_number": 2, "date": "2013-10-28 20:16:55.776000000", "author": {"name": "William Roberts"}},
      {"message": "Patch Set 3:\n\nCan you put together a patch which does what you propose?\n\nI'm not that familiar with how the certs are handled. It looks to me that PRODUCT_DEFAULT_DEV_CERTIFICATE is (should) always be defined.  Maybe I'm misunderstanding something...", "id": "5e49184c_d868a524", "_revision_number": 3, "date": "2013-10-28 20:25:47.340000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Patch Set 3: Code-Review+1\n\nNick: Your method works for me.\n\nBill: Are you sure you don't have it backwards. If PRODUCT_DEFAULT_DEV_CERTIFICATE is defined then   \n DEFAULT_SYSTEM_DEV_CERTIFICATE = PRODUCT_DEFAULT_DEV_CERTIFICATE\notherwise set\n DEFAULT_SYSTEM_DEV_CERTIFICATE = build/target/product/security/testkey.\n\nSo therefore DEFAULT_SYSTEM_DEV_CERTIFICATE is always guaranteed to be set.\n\nSo in your case wouldn't you want it as\n [@TAG] all: $DEFAULT_SYSTEM_DEV_CERTIFICATE/<somekey>.pem\n\n\nAll: There's definitely 3 or more ways to solve this problem; using -d, not using -d, using absolute paths in keys.conf or using env vars.... I'm good with anyway we ultimately choose. We probably should of just done a better job with the docs.", "id": "5ed67883_b036800d", "_revision_number": 3, "date": "2013-10-28 22:01:36.118000000", "author": {"name": "Robert Craig"}},
      {"message": "Patch Set 3: Code-Review+1\n\nNick,\nI may have had them back words as Bob mentioned. Either way, I think your most recent patch does what we want and is the cleanest approach, so LGTM.", "id": "5e49184c_4c95d388", "_revision_number": 3, "date": "2013-10-29 00:04:26.459000000", "author": {"name": "William Roberts"}},
      {"message": "Patch Set 3: Verified+1 Code-Review+2\n\nThanks all.", "id": "1e5ec0fd_c4b8bbbc", "_revision_number": 3, "date": "2013-10-29 00:06:52.667000000", "author": {"name": "Nick Kralevich"}},
      {"message": "Change has been successfully merged into the git repository.", "id": "fe62ccbe_f40d714f", "_revision_number": 3, "date": "2013-10-29 00:06:54.115000000", "author": {"name": "Nick Kralevich"}}],
  "branch": "master",
  "change_id": "Ica24fb25c5f9c0e2f4d181718c757cf372467822",
  "updated": "2013-10-29 00:06:52.957000000",
  "kind": "gerritcodereview#change",
  "id": "platform%2Fexternal%2Fsepolicy~master~Ica24fb25c5f9c0e2f4d181718c757cf372467822",
  "owner": {"name": "Nick Kralevich"},
  "_number": 68880,
  "project": "platform/external/sepolicy",
  "status": "MERGED",
  "current_revision": "c3c9052bc7bf7f55e66a7560a28800066a6e044b",
  "_sortkey": "0028bcc600010d10",
  "created": "2013-10-25 19:30:25.235000000"}]
